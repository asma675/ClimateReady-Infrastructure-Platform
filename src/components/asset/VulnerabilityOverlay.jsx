import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Users, Heart, Home, MapPin } from 'lucide-react';

export default function VulnerabilityOverlay({ asset }) {
  const vulnerability = asset.vulnerability_indicators || {
    seniors_population_pct: 22,
    low_income_pct: 15,
    indigenous_community: true,
    remote_location: false
  };

  const indicators = [
    {
      label: 'Senior Population',
      value: vulnerability.seniors_population_pct || 0,
      icon: Users,
      color: 'text-purple-500',
      bgColor: 'bg-purple-100',
      description: 'Percentage of seniors (65+) in service area'
    },
    {
      label: 'Low Income Households',
      value: vulnerability.low_income_pct || 0,
      icon: Home,
      color: 'text-blue-500',
      bgColor: 'bg-blue-100',
      description: 'Percentage below low income cut-off'
    }
  ];

  const flags = [
    {
      label: 'Indigenous Community',
      active: vulnerability.indigenous_community,
      icon: Heart,
      description: 'Serves Indigenous community'
    },
    {
      label: 'Remote Location',
      active: vulnerability.remote_location,
      icon: MapPin,
      description: 'Located in remote or isolated area'
    }
  ];

  const equityScore = Math.round(
    (vulnerability.seniors_population_pct || 0) * 0.3 +
    (vulnerability.low_income_pct || 0) * 0.3 +
    (vulnerability.indigenous_community ? 30 : 0) +
    (vulnerability.remote_location ? 20 : 0)
  );

  return (
    <Card className="border-slate-200">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg flex items-center gap-2">
            <Heart className="w-5 h-5 text-rose-500" />
            Equity & Vulnerability Lens
          </CardTitle>
          <Badge className={`${
            equityScore > 60 ? 'bg-rose-100 text-rose-700' :
            equityScore > 30 ? 'bg-amber-100 text-amber-700' :
            'bg-emerald-100 text-emerald-700'
          }`}>
            Vulnerability Score: {equityScore}
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Percentage Indicators */}
        <div className="space-y-4">
          {indicators.map((indicator, index) => {
            const Icon = indicator.icon;
            return (
              <div key={index} className="space-y-2">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className={`p-1.5 rounded-lg ${indicator.bgColor}`}>
                      <Icon className={`w-4 h-4 ${indicator.color}`} />
                    </div>
                    <span className="text-sm font-medium text-slate-700">{indicator.label}</span>
                  </div>
                  <span className="text-sm font-bold text-slate-900">{indicator.value}%</span>
                </div>
                <Progress value={indicator.value} className="h-2" />
                <p className="text-xs text-slate-400">{indicator.description}</p>
              </div>
            );
          })}
        </div>

        {/* Boolean Flags */}
        <div className="grid grid-cols-2 gap-3 pt-2">
          {flags.map((flag, index) => {
            const Icon = flag.icon;
            return (
              <div
                key={index}
                className={`p-3 rounded-lg border ${
                  flag.active 
                    ? 'bg-rose-50 border-rose-200' 
                    : 'bg-slate-50 border-slate-200'
                }`}
              >
                <div className="flex items-center gap-2 mb-1">
                  <Icon className={`w-4 h-4 ${flag.active ? 'text-rose-500' : 'text-slate-400'}`} />
                  <span className={`text-sm font-medium ${flag.active ? 'text-rose-700' : 'text-slate-500'}`}>
                    {flag.label}
                  </span>
                </div>
                <Badge variant={flag.active ? "default" : "secondary"} className="text-xs">
                  {flag.active ? 'Yes' : 'No'}
                </Badge>
              </div>
            );
          })}
        </div>

        {/* Policy Note */}
        <div className="bg-blue-50 rounded-lg p-3 border border-blue-100">
          <p className="text-xs text-blue-700">
            <strong>Policy Note:</strong> Assets serving vulnerable populations are prioritized 
            in accordance with GC Infrastructure Resilience Guidelines and the Accessible Canada Act.
          </p>
        </div>
      </CardContent>
    </Card>
  );
}